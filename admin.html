<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ç®¡ç†åå° - TJCA Website</title>
    <meta name="description" content="TJCA ç®¡ç†åå°">
    <meta name="keywords" content="TJCA,ç®¡ç†,åå°,é­”æ–¹">
    
    <meta name="theme-color" content="#1e40af">
    
    <!-- å›¾æ ‡ -->
    <link rel="icon" type="image/x-icon" href="assets/images/tjca.ico">
    
    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- ç®¡ç†åå°ä¸“ç”¨æ ·å¼ -->
    <style>
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }
        
        .admin-header {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
        }
        
        .admin-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        
        .admin-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .admin-tabs {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xl);
            background: var(--gray-100);
            padding: var(--spacing-xs);
            border-radius: var(--radius-lg);
            width: fit-content;
        }
        
        .admin-tab {
            padding: var(--spacing-sm) var(--spacing-lg);
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .admin-tab:hover {
            color: var(--text-primary);
            background: var(--bg-primary);
        }
        
        .admin-tab.active {
            background: var(--primary-color);
            color: var(--text-white);
            box-shadow: var(--shadow-sm);
        }
        
        .admin-content {
            display: none;
        }
        
        .admin-content.active {
            display: block;
        }
        
        .admin-card {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
        }
        
        .admin-card h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        /* å¤šé€‰æ¡†æ ·å¼ */

        .project-checkboxes {
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            background: var(--bg-primary);
        }

        .checkbox-row {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        .checkbox-row:last-child {
            margin-bottom: 0;
        }

        /* æ›´å¤šé¡¹ç›®æŒ‰é’®æ ·å¼ */
        .more-projects-toggle {
            display: flex;
            align-items: center;
            margin-left: var(--spacing-md);
        }

        .more-projects-toggle .btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .more-projects-toggle .btn:hover {
            background: var(--primary-50);
            border-color: var(--primary-300);
            color: var(--primary-700);
        }

        .more-projects-toggle .btn i {
            transition: transform 0.3s ease;
        }

        .more-projects-toggle .btn.expanded i {
            transform: rotate(180deg);
        }

        /* éšè—é¡¹ç›®åŒºåŸŸæ ·å¼ */
        .more-projects {
            margin-top: var(--spacing-sm);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .more-projects.hidden {
            max-height: 0;
            margin-top: 0;
            opacity: 0;
        }

        .more-projects.visible {
            max-height: 200px;
            margin-top: var(--spacing-sm);
            opacity: 1;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            cursor: pointer;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
            user-select: none;
        }

        .checkbox-item:hover {
            background: var(--gray-50);
        }

        .checkbox-item input[type="checkbox"] {
            margin: 0;
            width: 16px;
            height: 16px;
            accent-color: var(--primary-color);
        }

        .checkbox-item span {
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .checkbox-item:has(input:checked) {
            background: var(--primary-color);
            color: var(--text-white);
        }

        .checkbox-item:has(input:checked) span {
            color: var(--text-white);
        }
        
        .form-group label {
            display: block;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }
        
        .form-control {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
        }

        /* å‘¨èµ›è¡¨å•ç‰¹æ®Šæ ·å¼ */
        #add-contest-form .form-row {
            display: flex;
            gap: var(--spacing-md);
        }

        #add-contest-form .form-group:first-child {
            flex: 0 0 200px; /* å‘¨æ¬¡è¾“å…¥æ¡†å›ºå®šå®½åº¦ */
        }

        #add-contest-form .form-group:last-child {
            flex: 0 0 180px; /* æ—¥æœŸè¾“å…¥æ¡†å›ºå®šå®½åº¦ */
        }
        
        .btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            border: none;
            border-radius: var(--radius-md);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: var(--text-white);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--gray-100);
            color: var(--text-primary);
            border: 1px solid var(--gray-300);
        }
        
        .btn-secondary:hover {
            background: var(--gray-200);
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: var(--text-white);
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-success {
            background: var(--accent-color);
            color: var(--text-white);
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--spacing-lg);
        }
        
        .data-table th,
        .data-table td {
            padding: var(--spacing-sm) var(--spacing-md);
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .data-table th {
            background: var(--gray-50);
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .data-table td {
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        
        .data-table tr:hover {
            background: var(--gray-50);
        }
        
        .action-buttons {
            display: flex;
            gap: var(--spacing-sm);
        }
        
        .status-badge {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .status-active {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-inactive {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #d97706;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }
        
        .stat-card {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .loading {
            text-align: center;
            padding: var(--spacing-2xl);
            color: var(--text-secondary);
        }
        
        .error {
            text-align: center;
            padding: var(--spacing-2xl);
            color: var(--danger-color);
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--gray-200);
        }

        .modal-header h3 {
            margin: 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--gray-100);
            color: var(--text-primary);
        }

        /* é¡¹ç›®é€‰æ‹©æ ·å¼ */
        .project-selection {
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-md);
            background: var(--gray-50);
            border-radius: var(--radius-md);
        }

        .project-selection label {
            font-weight: 600;
            margin-right: var(--spacing-sm);
        }

        .project-selection select {
            width: 200px;
        }

        /* å¿«é€Ÿå½•å…¥åŒºåŸŸæ ·å¼ */
        .quick-entry-section {
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }

        .quick-entry-section h4 {
            margin: 0 0 var(--spacing-md) 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .quick-entry-form .form-row {
            display: flex;
            gap: var(--spacing-md);
            align-items: end;
        }

        .quick-entry-form .form-group {
            flex: 1;
        }

        .quick-entry-form .form-group:last-child {
            flex: none;
        }

        /* å·²å½•å…¥æˆç»©åŒºåŸŸæ ·å¼ */
        .entered-scores-section {
            margin-bottom: var(--spacing-lg);
        }

        .scores-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
        }

        .scores-header h4 {
            margin: 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        #toggle-edit-mode {
            transition: all 0.3s ease;
        }

        #toggle-edit-mode.active {
            background: var(--primary-color);
            color: var(--text-white);
            border-color: var(--primary-color);
        }

        .entered-scores-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
        }

        .score-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--gray-200);
            transition: background-color 0.2s ease;
            min-height: 48px;
        }

        .score-item:last-child {
            border-bottom: none;
        }

        .score-item:hover {
            background: var(--gray-50);
        }

        .score-item.editing {
            background: var(--primary-50);
        }

        .score-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .score-player {
            font-weight: 600;
            min-width: 100px;
        }

        .player-name {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 2px;
            line-height: 1.2;
        }

        .player-meta {
            display: flex;
            gap: var(--spacing-xs);
            align-items: center;
        }

        .round-badge {
            background: var(--primary-100);
            color: var(--primary-700);
            padding: 1px 4px;
            border-radius: var(--radius-sm);
            font-size: 0.7rem;
            font-weight: 500;
        }

        .time-badge {
            background: var(--gray-100);
            color: var(--text-secondary);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
        }

        .score-times {
            display: flex;
            gap: var(--spacing-xs);
            flex-wrap: wrap;
        }

        .score-time {
            background: var(--gray-100);
            padding: 1px 4px;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
        }

        .score-time.best {
            background: var(--success-100);
            color: var(--success-700);
        }

        .score-time.worst {
            background: var(--danger-100);
            color: var(--danger-700);
        }

        .score-actions {
            display: flex;
            gap: var(--spacing-xs);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .score-item:hover .score-actions {
            opacity: 1;
        }

        .score-item.edit-mode .score-actions {
            opacity: 1;
        }

        .score-actions .btn {
            padding: 2px 6px;
            font-size: 0.8rem;
            min-width: 28px;
            height: 24px;
        }

        .score-actions .btn-danger {
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .score-actions .btn-danger:hover {
            opacity: 1;
        }

        .score-edit-form {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            flex: 1;
        }

        .score-edit-form input {
            padding: var(--spacing-xs);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
        }

        .score-edit-form .player-name-edit {
            min-width: 80px;
        }

        .score-edit-form .times-edit {
            flex: 1;
        }

        .score-edit-form .round-edit {
            min-width: 80px;
        }

        /* å‘¨èµ›ç¼–è¾‘æ¨¡æ€æ¡†æ ·å¼ */
        .contest-edit-info {
            background: var(--gray-50);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-lg);
        }

        .contest-basic-info {
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: var(--gray-50);
            border-radius: var(--radius-md);
        }

        .contest-basic-info h4 {
            margin: 0 0 var(--spacing-md) 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .contest-projects {
            margin-bottom: var(--spacing-lg);
        }

        .contest-projects h4 {
            margin: 0 0 var(--spacing-md) 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .projects-list {
            margin-bottom: var(--spacing-lg);
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
        }

        .project-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--gray-200);
        }

        .project-item:last-child {
            border-bottom: none;
        }

        .project-item:hover {
            background: var(--gray-50);
        }

        .project-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .project-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .project-stats {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .project-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        .project-actions .btn {
            padding: 2px 6px;
            font-size: 0.8rem;
            min-width: 24px;
            height: 24px;
        }

        .add-project-section {
            padding: var(--spacing-md);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }

        .add-project-section h5 {
            margin: 0 0 var(--spacing-sm) 0;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .modal-body {
            padding: var(--spacing-lg);
        }

        /* ç¤¾äº¤åª’ä½“é“¾æ¥æ ·å¼ */
        .social-links {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: var(--text-white);
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .social-link:hover {
            background: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .social-link i {
            font-size: 1.2rem;
        }

        .score-entry-info {
            background: var(--gray-50);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-lg);
        }

        .score-entry-info h4 {
            margin: 0 0 var(--spacing-xs) 0;
            color: var(--primary-color);
        }

        .score-entry-info p {
            margin: 0;
            color: var(--text-secondary);
        }

        .player-input-group {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            align-items: center;
        }

        .player-input-group input {
            flex: 1;
        }

        .player-input-group .btn-danger {
            padding: var(--spacing-sm);
            min-width: 40px;
        }

        .form-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--gray-200);
        }

        /* é¡¹ç›®åˆ—è¡¨æ ·å¼ */
        .project-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .project-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }

        .project-name {
            font-weight: 500;
            color: var(--text-primary);
            min-width: 60px;
        }

        .project-count {
            color: var(--text-secondary);
            font-size: 0.875rem;
            min-width: 50px;
        }

        /* å¸®åŠ©æç¤ºæ ·å¼ */
        .btn-group-with-help {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .help-icon-container {
            position: relative;
            display: inline-block;
        }

        .help-icon {
            color: var(--primary-color);
            font-size: 1.1rem;
            cursor: help;
            transition: all 0.3s ease;
        }

        .help-icon:hover {
            color: var(--primary-dark);
            transform: scale(1.1);
        }

        .help-tooltip {
            position: absolute;
            bottom: calc(100% + 10px);
            right: 0;
            background: var(--gray-900);
            color: var(--text-white);
            padding: var(--spacing-md);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            min-width: 300px;
            max-width: 350px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .help-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            right: 20px;
            border: 6px solid transparent;
            border-top-color: var(--gray-900);
        }

        .help-icon:hover + .help-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .tooltip-content h4 {
            margin: 0 0 var(--spacing-sm) 0;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-white);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: var(--spacing-xs);
        }

        .format-examples {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .format-example {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-xs) 0;
            font-size: 0.8rem;
        }

        .format-project {
            font-weight: 500;
            color: var(--primary-200);
            min-width: 60px;
        }

        .format-sample {
            font-family: monospace;
            color: var(--gray-300);
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
        }

        .format-note {
            font-size: 0.75rem;
            color: var(--gray-400);
            margin-top: var(--spacing-xs);
            padding-top: var(--spacing-xs);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        /* é¡¹ç›®æ ‡ç­¾é¡µæ ·å¼ */
        .project-tabs-container {
            margin-top: var(--spacing-lg);
        }

        .project-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--gray-200);
            padding-bottom: var(--spacing-sm);
        }

        .project-tab {
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .project-tab:hover {
            background: var(--gray-200);
            border-color: var(--gray-400);
        }

        .project-tab.active {
            background: var(--primary-color);
            color: var(--text-white);
            border-color: var(--primary-color);
        }

        .project-content {
            min-height: 300px;
        }

        .project-panel {
            display: none;
        }

        .project-panel.active {
            display: block;
        }

        .project-panel h4 {
            margin: 0 0 var(--spacing-md) 0;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .project-panel h4 i {
            font-size: 1.25rem;
        }
        
        @media (max-width: 768px) {
            .admin-container {
                padding: var(--spacing-md);
            }
            
            .admin-tabs {
                flex-direction: column;
                width: 100%;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .data-table {
                font-size: 0.75rem;
            }

            .modal-content {
                width: 95%;
                margin: var(--spacing-md);
            }

            .form-actions {
                flex-direction: column;
            }

            .help-tooltip {
                position: fixed;
                left: var(--spacing-md);
                right: var(--spacing-md);
                bottom: 20%;
                min-width: auto;
                max-width: none;
                width: calc(100vw - 2 * var(--spacing-md));
            }

            .help-tooltip::after {
                display: none;
            }

            .btn-group-with-help {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-xs);
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <i class="fas fa-cube"></i>
                TJCA Website
            </a>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    é¦–é¡µ
                </a>
                <!-- æ ¡è®°å½•åŠŸèƒ½æš‚æ—¶åœç”¨
                <a href="school-records.html" class="nav-link">
                    <i class="fas fa-trophy"></i>
                    æ ¡è®°å½•
                </a>
                -->
                <a href="weekly-contests.html" class="nav-link">
                    <i class="fas fa-calendar-week"></i>
                    å‘¨èµ›è®°å½•
                </a>
                <a href="admin.html" class="nav-link active">
                    <i class="fas fa-cog"></i>
                    ç®¡ç†åå°
                </a>
            </div>
            <div class="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="main-content">
        <div class="admin-container">
            <!-- ç®¡ç†åå°å¤´éƒ¨ -->
            <div class="admin-header">
                <h1 class="admin-title">
                    <i class="fas fa-cog"></i>
                    ç®¡ç†åå°
                </h1>
                <p class="admin-subtitle">ç®¡ç†ç³»ç»Ÿæ•°æ®ã€ç”¨æˆ·æƒé™å’Œç³»ç»Ÿè®¾ç½®</p>
            </div>


            <!-- ç®¡ç†æ ‡ç­¾é¡µ -->
            <div class="admin-tabs">
                <!-- <button class="admin-tab active" data-tab="records">
                    <i class="fas fa-trophy"></i>
                    æ ¡è®°å½•ç®¡ç†
                </button> -->
                <button class="admin-tab active" data-tab="contests">
                    <i class="fas fa-calendar-week"></i>
                    å‘¨èµ›ç®¡ç†
                </button>
                <!-- <button class="admin-tab" data-tab="users">
                    <i class="fas fa-users"></i>
                    ç”¨æˆ·ç®¡ç†
                </button>
                <button class="admin-tab" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    ç³»ç»Ÿè®¾ç½®
                </button> -->
            </div>

            

            <!-- å‘¨èµ›ç®¡ç† -->
            <div id="contests-tab" class="admin-content active">
                <div class="admin-card">
                    <h3>
                        <i class="fas fa-plus"></i>
                        æ·»åŠ å‘¨èµ›è®°å½•
                    </h3>
                    <form id="add-contest-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="contest-week">å‘¨æ¬¡</label>
                                <input type="text" id="contest-week" name="contest-week" class="form-control" required placeholder="ç¬¬1å‘¨">
                            </div>
                            <div class="form-group">
                                <label for="contest-date">æ—¥æœŸ</label>
                                <input type="date" id="contest-date" name="contest-date" class="form-control" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="contest-projects">é¡¹ç›®ï¼ˆå¯å¤šé€‰ï¼‰</label>
                            <div class="project-checkboxes">
                                <!-- ç¬¬ä¸€è¡Œï¼šä¸‰é˜¶ äºŒé˜¶ ä¸‰é˜¶å•æ‰‹ å››é˜¶ -->
                                <div class="checkbox-row">
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="contest-projects" value="ä¸‰é˜¶">
                                        <span>ä¸‰é˜¶</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="contest-projects" value="äºŒé˜¶">
                                        <span>äºŒé˜¶</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="contest-projects" value="å››é˜¶">
                                        <span>å››é˜¶</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="contest-projects" value="ä¸‰é˜¶å•æ‰‹">
                                        <span>ä¸‰é˜¶å•æ‰‹</span>
                                    </label>
                                </div>
                                
                                <!-- ç¬¬äºŒè¡Œï¼šäº”é˜¶ å…­é˜¶ ä¸ƒé˜¶ -->
                                <div class="checkbox-row">
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="contest-projects" value="äº”é˜¶">
                                        <span>äº”é˜¶</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="contest-projects" value="å…­é˜¶">
                                        <span>å…­é˜¶</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="contest-projects" value="ä¸ƒé˜¶">
                                        <span>ä¸ƒé˜¶</span>
                                    </label>
                                </div>
                                
                                <!-- ç¬¬ä¸‰è¡Œï¼šæ–œè½¬ é‡‘å­—å¡” é­”è¡¨ SQ1 äº”é­”æ–¹ -->
                                <div class="checkbox-row">
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="contest-projects" value="æ–œè½¬">
                                        <span>æ–œè½¬</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="contest-projects" value="é‡‘å­—å¡”">
                                        <span>é‡‘å­—å¡”</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="contest-projects" value="é­”è¡¨">
                                        <span>é­”è¡¨</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="contest-projects" value="SQ1">
                                        <span>SQ1</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="contest-projects" value="äº”é­”æ–¹">
                                        <span>äº”é­”æ–¹</span>
                                    </label>
                                    
                                    <!-- æ›´å¤šé¡¹ç›®æŒ‰é’® -->
                                    <div class="more-projects-toggle">
                                        <button type="button" class="btn btn-sm btn-outline" onclick="toggleMoreProjects()">
                                            <i class="fas fa-chevron-down" id="more-projects-icon"></i>
                                            <span id="more-projects-text">æ›´å¤š</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- éšè—çš„é¡¹ç›® -->
                                <div class="more-projects hidden" id="more-projects" style="display: none;">
                                    <div class="checkbox-row">
                                        <label class="checkbox-item">
                                            <input type="checkbox" name="contest-projects" value="æœ€å°‘æ­¥">
                                            <span>æœ€å°‘æ­¥</span>
                                        </label>
                                        <label class="checkbox-item">
                                            <input type="checkbox" name="contest-projects" value="ä¸‰é˜¶ç›²æ‹§">
                                            <span>ä¸‰é˜¶ç›²æ‹§</span>
                                        </label>
                                        <label class="checkbox-item">
                                            <input type="checkbox" name="contest-projects" value="å››é˜¶ç›²æ‹§">
                                            <span>å››é˜¶ç›²æ‹§</span>
                                        </label>
                                        <label class="checkbox-item">
                                            <input type="checkbox" name="contest-projects" value="äº”é˜¶ç›²æ‹§">
                                            <span>äº”é˜¶ç›²æ‹§</span>
                                        </label>
                                    </div>
                                    <!-- è¶£å‘³é¡¹ç›® -->
                                    <div class="checkbox-row">
                                        <label class="checkbox-item">
                                            <input type="checkbox" name="contest-projects" value="å¥—æ‹§">
                                            <span>å¥—æ‹§ ğŸ®</span>
                                        </label>
                                        <label class="checkbox-item">
                                            <input type="checkbox" name="contest-projects" value="é»„è‰²æŒ¡æ¿">
                                            <span>é»„è‰²æŒ¡æ¿ ğŸ®</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                æ·»åŠ å‘¨èµ›
                            </button>
                        </div>
                    </form>
                </div>

                <div class="admin-card">
                    <h3>
                        <i class="fas fa-list"></i>
                        å‘¨èµ›è®°å½•åˆ—è¡¨
                    </h3>
                    <div id="contests-list">
                        <div class="loading">
                            <div class="loading"></div>
                            <p>åŠ è½½ä¸­...</p>
                        </div>
                    </div>
                </div>

                <!-- å‘¨èµ›ç¼–è¾‘æ¨¡æ€æ¡† -->
                <div id="contest-edit-modal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>
                                <i class="fas fa-edit"></i>
                                ç¼–è¾‘å‘¨èµ›
                            </h3>
                            <button class="modal-close" onclick="closeContestEditModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="contest-edit-info">
                                <h4 id="contest-edit-week"></h4>
                                <p id="contest-edit-date"></p>
                            </div>
                            
                            <!-- éšè—çš„å‘¨èµ›ID -->
                            <input type="hidden" id="contest-edit-id">
                            
                            <!-- åŸºæœ¬ä¿¡æ¯ç¼–è¾‘ -->
                            <div class="contest-basic-info">
                                <h4>
                                    <i class="fas fa-info-circle"></i>
                                    åŸºæœ¬ä¿¡æ¯
                                </h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="edit-week">å‘¨æ¬¡ï¼š</label>
                                        <input type="text" id="edit-week" class="form-control" placeholder="å¦‚ï¼šç¬¬1å‘¨">
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-date">æ—¥æœŸï¼š</label>
                                        <input type="date" id="edit-date" class="form-control">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- é¡¹ç›®ç®¡ç† -->
                            <div class="contest-projects">
                                <h4>
                                    <i class="fas fa-cube"></i>
                                    é¡¹ç›®ç®¡ç†
                                </h4>
                                <div class="projects-list" id="projects-list">
                                    <!-- åŠ¨æ€æ˜¾ç¤ºç°æœ‰é¡¹ç›® -->
                                </div>
                                
                                <!-- æ·»åŠ æ–°é¡¹ç›® -->
                                <div class="add-project-section">
                                    <h5>æ·»åŠ æ–°é¡¹ç›®</h5>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <select id="new-project-select" class="form-control">
                                                <option value="">é€‰æ‹©é¡¹ç›®</option>
                                                <option value="ä¸‰é˜¶">ä¸‰é˜¶</option>
                                                <option value="äºŒé˜¶">äºŒé˜¶</option>
                                                <option value="å››é˜¶">å››é˜¶</option>
                                                <option value="äº”é˜¶">äº”é˜¶</option>
                                                <option value="å…­é˜¶">å…­é˜¶</option>
                                                <option value="ä¸ƒé˜¶">ä¸ƒé˜¶</option>
                                                <option value="ä¸‰é˜¶ç›²æ‹§">ä¸‰é˜¶ç›²æ‹§</option>
                                                <option value="å››é˜¶ç›²æ‹§">å››é˜¶ç›²æ‹§</option>
                                                <option value="äº”é˜¶ç›²æ‹§">äº”é˜¶ç›²æ‹§</option>
                                                <option value="æœ€å°‘æ­¥">æœ€å°‘æ­¥</option>
                                                <option value="ä¸‰é˜¶å•æ‰‹">ä¸‰é˜¶å•æ‰‹</option>
                                                <option value="é­”è¡¨">é­”è¡¨</option>
                                                <option value="äº”é­”æ–¹">äº”é­”æ–¹</option>
                                                <option value="é‡‘å­—å¡”">é‡‘å­—å¡”</option>
                                                <option value="æ–œè½¬">æ–œè½¬</option>
                                                <option value="SQ1">SQ1</option>
                                                <option value="å¥—æ‹§">å¥—æ‹§ ğŸ®</option>
                                                <option value="é»„è‰²æŒ¡æ¿">é»„è‰²æŒ¡æ¿ ğŸ®</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <button type="button" class="btn btn-primary" onclick="addProjectToContest()">
                                                <i class="fas fa-plus"></i>
                                                æ·»åŠ é¡¹ç›®
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-primary" onclick="saveContestEdit()">
                                    <i class="fas fa-save"></i>
                                    ä¿å­˜ä¿®æ”¹
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="closeContestEditModal()">
                                    <i class="fas fa-times"></i>
                                    å–æ¶ˆ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æˆç»©å½•å…¥æ¨¡æ€æ¡† -->
                <div id="score-entry-modal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>
                                <i class="fas fa-edit"></i>
                                å½•å…¥æˆç»©
                            </h3>
                            <button class="modal-close" onclick="closeScoreEntryModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="score-entry-info">
                                <h4 id="score-entry-week"></h4>
                                <p id="score-entry-date"></p>
                            </div>
                            
                            <!-- éšè—çš„å‘¨èµ›ID -->
                            <input type="hidden" id="score-entry-contest-id">
                            
                            <!-- é¡¹ç›®é€‰æ‹© -->
                            <div class="project-selection">
                                <label for="project-select">é€‰æ‹©é¡¹ç›®ï¼š</label>
                                <select id="project-select" class="form-control">
                                    <!-- åŠ¨æ€ç”Ÿæˆé¡¹ç›®é€‰é¡¹ -->
                                </select>
                                <div class="project-info-display" id="project-info-display" style="margin-top: var(--spacing-sm); padding: var(--spacing-sm); background: var(--gray-50); border-radius: var(--radius-sm); font-size: 0.875rem; color: var(--text-secondary);">
                                    <!-- é¡¹ç›®é…ç½®ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                                </div>
                            </div>
                            
                            <!-- å¿«é€Ÿå½•å…¥åŒºåŸŸ -->
                            <div class="quick-entry-section">
                                <h4>
                                    <i class="fas fa-plus"></i>
                                    å¿«é€Ÿå½•å…¥
                                </h4>
                                <div class="quick-entry-form">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="player-name-input">é€‰æ‰‹å§“åï¼š</label>
                                            <input type="text" id="player-name-input" class="form-control" placeholder="è¯·è¾“å…¥é€‰æ‰‹å§“å">
                                        </div>
                                        <div class="form-group">
                                            <label for="round-input">è½®æ•°ï¼š</label>
                                            <select id="round-input" class="form-control">
                                                <option value="1">ç¬¬1è½®</option>
                                                <option value="2">ç¬¬2è½®</option>
                                                <option value="3">ç¬¬3è½®</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="times-input">æˆç»©ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼‰ï¼š</label>
                                            <input type="text" id="times-input" class="form-control" placeholder="å¦‚ï¼š5.89 6.12 5.45 6.01 5.78 ">
                                        </div>
                                        <div class="form-group">
                                            <div class="btn-group-with-help">
                                                <button type="button" class="btn btn-primary" onclick="quickAddScore()">
                                                    <i class="fas fa-save"></i>
                                                    å½•å…¥æˆç»©
                                                </button>
                                                <div class="help-icon-container">
                                                    <i class="fas fa-question-circle help-icon" id="score-format-help"></i>
                                                    <div class="help-tooltip" id="score-format-tooltip">
                                                        <div class="tooltip-content">
                                                            <h4>å¿«é€Ÿå½•å…¥æ ¼å¼</h4>
                                                            <div class="format-examples">
                                                                <div class="format-example">
                                                                    <span class="format-project">ä¸‰é˜¶</span>
                                                                    <span class="format-sample">5.89 6.12+ DNF 5.45 6.01</span>
                                                                </div>
                                                                
                                                                <div class="format-example">
                                                                    <span class="format-project">å››é˜¶</span>
                                                                    <span class="format-sample">45.67 1:02.32 50.12 36.93 DNF</span>
                                                                </div>
                                                                <div class="format-example">
                                                                    <span class="format-project">å…­é˜¶</span>
                                                                    <span class="format-sample">2:45.67 3:02.34 2:55.12</span>
                                                                </div>
                                                                <div class="format-example">
                                                                    <span class="format-project">ç›²æ‹§</span>
                                                                    <span class="format-sample">1:25.67 DNF 1:35.12</span>
                                                                </div>
                                                                <div class="format-example">
                                                                    <span class="format-project">æœ€å°‘æ­¥</span>
                                                                    <span class="format-sample">25 30 28</span>
                                                                </div>
                                                                <div class="format-note">
                                                                    æ”¯æŒï¼šæ™®é€šæˆç»©ã€+2æƒ©ç½š(+)ã€DNFã€é•¿æ—¶é—´(åˆ†:ç§’)
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- å·²å½•å…¥æˆç»©æ˜¾ç¤ºåŒºåŸŸ -->
                            <div class="entered-scores-section">
                                <div class="scores-header">
                                    <h4>
                                        <i class="fas fa-list"></i>
                                        å·²å½•å…¥æˆç»©
                                    </h4>
                                    <button type="button" class="btn btn-sm btn-outline" id="toggle-edit-mode" onclick="toggleEditMode()">
                                        <i class="fas fa-edit"></i>
                                        ç¼–è¾‘
                                    </button>
                                </div>
                                <div id="entered-scores-list" class="entered-scores-list">
                                    <!-- åŠ¨æ€æ˜¾ç¤ºå·²å½•å…¥çš„æˆç»© -->
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeScoreEntryModal()">
                                    <i class="fas fa-times"></i>
                                    å…³é—­
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ ¡è®°å½•ç®¡ç†åŠŸèƒ½æš‚æ—¶åœç”¨
            <div id="records-tab" class="admin-content active">
                <div class="admin-card">
                    <h3>
                        <i class="fas fa-plus"></i>
                        æ·»åŠ æ ¡è®°å½•
                    </h3>
                    <form id="add-record-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="record-project">é¡¹ç›®</label>
                                <select id="record-project" class="form-control" required>
                                    <option value="">é€‰æ‹©é¡¹ç›®</option>
                                    <option value="ä¸‰é˜¶">ä¸‰é˜¶</option>
                                    <option value="äºŒé˜¶">äºŒé˜¶</option>
                                    <option value="å››é˜¶">å››é˜¶</option>
                                    <option value="äº”é˜¶">äº”é˜¶</option>
                                    <option value="å…­é˜¶">å…­é˜¶</option>
                                    <option value="ä¸ƒé˜¶">ä¸ƒé˜¶</option>
                                    <option value="ä¸‰é˜¶ç›²æ‹§">ä¸‰é˜¶ç›²æ‹§</option>
                                    <option value="å››é˜¶ç›²æ‹§">å››é˜¶ç›²æ‹§</option>
                                    <option value="äº”é˜¶ç›²æ‹§">äº”é˜¶ç›²æ‹§</option>
                                    <option value="æœ€å°‘æ­¥">æœ€å°‘æ­¥</option>
                                    <option value="ä¸‰é˜¶å•æ‰‹">ä¸‰é˜¶å•æ‰‹</option>
                                    <option value="é­”è¡¨">é­”è¡¨</option>
                                    <option value="äº”é­”æ–¹">äº”é­”æ–¹</option>
                                    <option value="é‡‘å­—å¡”">é‡‘å­—å¡”</option>
                                    <option value="æ–œè½¬">æ–œè½¬</option>
                                    <option value="SQ1">SQ1</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="record-name">å§“å</label>
                                <input type="text" id="record-name" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="record-grade">å¹´çº§</label>
                                <input type="text" id="record-grade" class="form-control" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="record-single">å•æ¬¡æˆç»©</label>
                                <input type="text" id="record-single" class="form-control" placeholder="å¦‚: 5.89">
                            </div>
                            <div class="form-group">
                                <label for="record-average">å¹³å‡æˆç»©</label>
                                <input type="text" id="record-average" class="form-control" placeholder="å¦‚: 7.98">
                            </div>
                            <div class="form-group">
                                <label for="record-date">æ—¥æœŸ</label>
                                <input type="date" id="record-date" class="form-control" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="record-competition">æ¯”èµ›åç§°</label>
                            <input type="text" id="record-competition" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                æ·»åŠ è®°å½•
                            </button>
                        </div>
                    </form>
                </div>

                <div class="admin-card">
                    <h3>
                        <i class="fas fa-list"></i>
                        æ ¡è®°å½•åˆ—è¡¨
                    </h3>
                    <div id="records-list">
                        <div class="loading">
                            <div class="loading"></div>
                            <p>åŠ è½½ä¸­...</p>
                        </div>
                    </div>
                </div>
            </div>
            -->

            <!-- ç”¨æˆ·ç®¡ç† -->
            <div id="users-tab" class="admin-content">
                <div class="admin-card">
                    <h3>
                        <i class="fas fa-users"></i>
                        ç”¨æˆ·ç®¡ç†
                    </h3>
                    <div class="error">
                        <i class="fas fa-tools" style="font-size: 2rem; margin-bottom: 16px; display: block; color: var(--primary-color);"></i>
                        <h3 style="margin: 0 0 8px 0; color: var(--text-primary);">åŠŸèƒ½å¼€å‘ä¸­</h3>
                        <p style="margin: 0; font-size: 0.9rem;">ç”¨æˆ·ç®¡ç†åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼</p>
                    </div>
                </div>
            </div>

            <!-- ç³»ç»Ÿè®¾ç½® -->
            <div id="settings-tab" class="admin-content">
                <div class="admin-card">
                    <h3>
                        <i class="fas fa-cog"></i>
                        ç³»ç»Ÿè®¾ç½®
                    </h3>
                    <div class="error">
                        <i class="fas fa-tools" style="font-size: 2rem; margin-bottom: 16px; display: block; color: var(--primary-color);"></i>
                        <h3 style="margin: 0 0 8px 0; color: var(--text-primary);">åŠŸèƒ½å¼€å‘ä¸­</h3>
                        <p style="margin: 0; font-size: 0.9rem;">ç³»ç»Ÿè®¾ç½®åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>TJCA Website</h4>
                    <p>åŒæµå¤§å­¦é­”æ–¹ç¤¾ç½‘ç«™</p>
                </div>
                <div class="footer-section">
                    <h4>å¿«é€Ÿé“¾æ¥</h4>
                    <ul>
                        <li><a href="index.html">é¦–é¡µ</a></li>
                        <!-- <li><a href="school-records.html">æ ¡è®°å½•</a></li> -->
                        <li><a href="weekly-contests.html">å‘¨èµ›è®°å½•</a></li>
                        <li><a href="admin.html">ç®¡ç†åå°</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>è”ç³»æˆ‘ä»¬</h4>
                    <p>å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»TJCAç®¡ç†å‘˜</p>
                    <div class="social-links">
                        <a href="https://space.bilibili.com/1299547652" target="_blank" class="social-link" title="Bilibili">
                            <i class="fab fa-bilibili"></i>
                        </a>
                        <a href="https://github.com/huizhiLLL/TJCA" target="_blank" class="social-link" title="GitHub">
                            <i class="fab fa-github"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 TJCA Website. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script type="module" src="assets/js/app.js"></script>
    <script type="module">
        // ç®¡ç†åå°ä¸“ç”¨è„šæœ¬
        import { contestsAPI, contestScoresAPI } from './assets/js/api.js';
        import { showSuccess, showError, animateCounter } from './assets/js/utils.js';
        import { getProjectConfig, getProjectAttempts, getProjectScoringMethod, getProjectTimeFormat, getAllProjects, getProjectsByCategory } from './assets/js/projectConfig.js';
        import { parseTimeString, validateTimeForProject, getTimeInputPlaceholder, formatTimeDisplay } from './assets/js/timeUtils.js';
        import { processPlayerResult, calculateProjectRanking, validatePlayerScores, generateScoreSummary } from './assets/js/scoringUtils.js';

        class AdminManager {
            constructor() {
                this.currentTab = 'contests';
                this.editMode = false; // ç¼–è¾‘æ¨¡å¼çŠ¶æ€
                this.contests = []; // åˆå§‹åŒ–å‘¨èµ›æ•°ç»„
                this.records = []; // åˆå§‹åŒ–è®°å½•æ•°ç»„
                this.init();
            }

            async init() {
                this.bindEvents();
                this.loadRecords();
                this.loadContests();
                this.switchTab('contests'); // é»˜è®¤æ˜¾ç¤ºå‘¨èµ›ç®¡ç†æ ‡ç­¾é¡µ
                this.bindScoreEntryEvents();
                this.bindContestEditEvents();
            }


            animateStat(elementId, value) {
                const element = document.getElementById(elementId);
                if (element) {
                    animateCounter(element, 0, value, 1000);
                }
            }

            // ç»‘å®šæˆç»©å½•å…¥ç›¸å…³äº‹ä»¶
            bindScoreEntryEvents() {
                // é¡¹ç›®é€‰æ‹©å˜åŒ–äº‹ä»¶
                document.addEventListener('change', (e) => {
                    if (e.target.id === 'project-select') {
                        const contestId = document.getElementById('score-entry-contest-id').value;
                        const projectName = e.target.value;
                        
                        if (contestId && projectName) {
                            this.loadEnteredScores(contestId, projectName);
                            this.updateProjectInfo(projectName);
                            this.updateTimesInputPlaceholder(projectName);
                        }
                    }
                });
            }

            // æ›´æ–°é¡¹ç›®ä¿¡æ¯æ˜¾ç¤º
            updateProjectInfo(projectName) {
                const infoDisplay = document.getElementById('project-info-display');
                if (!infoDisplay || !projectName) return;
                
                const config = getProjectConfig(projectName);
                
                infoDisplay.innerHTML = `
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                        <i class="fas fa-info-circle"></i>
                        <span><strong>${config.displayName}</strong>: ${config.description}</span>
                    </div>
                    <div style="margin-top: var(--spacing-xs); font-size: 0.8rem;">
                        æˆç»©æ•°é‡: ${config.attempts}æŠŠ | 
                        è®¡åˆ†æ–¹å¼: ${this.getScoringMethodDisplay(config.scoringMethod)} | 
                        æ—¶é—´æ ¼å¼: ${this.getTimeFormatDisplay(config.timeFormat)}
                    </div>
                `;
            }

            // è·å–è®¡åˆ†æ–¹å¼æ˜¾ç¤ºæ–‡æœ¬
            getScoringMethodDisplay(method) {
                const methods = {
                    'single': 'æœ€ä½³å•æ¬¡',
                    'mo3': '3æ¬¡å¹³å‡',
                    'ao5': '5æ¬¡å»å¤´å°¾å¹³å‡'
                };
                return methods[method] || method;
            }

            // è·å–æ—¶é—´æ ¼å¼æ˜¾ç¤ºæ–‡æœ¬
            getTimeFormatDisplay(format) {
                const formats = {
                    'standard': 'æ ‡å‡†æ—¶é—´',
                    'extended': 'é•¿æ—¶é—´æ ¼å¼',
                    'moves': 'æ­¥æ•°'
                };
                return formats[format] || format;
            }

            // æ›´æ–°æ—¶é—´è¾“å…¥æ¡†çš„æç¤ºæ–‡æœ¬
            updateTimesInputPlaceholder(projectName) {
                const timesInput = document.getElementById('times-input');
                if (timesInput) {
                    timesInput.placeholder = getTimeInputPlaceholder(projectName);
                }
            }

            // ç»‘å®šå‘¨èµ›ç¼–è¾‘ç›¸å…³äº‹ä»¶
            bindContestEditEvents() {
                // æ–°é¡¹ç›®é€‰æ‹©å˜åŒ–äº‹ä»¶
                document.addEventListener('change', (e) => {
                    if (e.target.id === 'new-project-select') {
                        this.updateAddProjectButton();
                    }
                });
            }

            // æ›´æ–°æ·»åŠ é¡¹ç›®æŒ‰é’®çŠ¶æ€
            updateAddProjectButton() {
                const select = document.getElementById('new-project-select');
                const button = document.querySelector('button[onclick="addProjectToContest()"]');
                const selectedProject = select.value;
                const existingProjects = Array.from(document.querySelectorAll('.project-name')).map(el => el.textContent);
                
                if (selectedProject && !existingProjects.includes(selectedProject)) {
                    button.disabled = false;
                    button.classList.remove('btn-secondary');
                    button.classList.add('btn-primary');
                } else {
                    button.disabled = true;
                    button.classList.remove('btn-primary');
                    button.classList.add('btn-secondary');
                }
            }

            // åˆ‡æ¢ç¼–è¾‘æ¨¡å¼
            toggleEditMode() {
                this.editMode = !this.editMode;
                const toggleBtn = document.getElementById('toggle-edit-mode');
                const scoresList = document.getElementById('entered-scores-list');
                
                if (this.editMode) {
                    toggleBtn.classList.add('active');
                    toggleBtn.innerHTML = '<i class="fas fa-check"></i> å®Œæˆ';
                    scoresList.classList.add('edit-mode');
                } else {
                    toggleBtn.classList.remove('active');
                    toggleBtn.innerHTML = '<i class="fas fa-edit"></i> ç¼–è¾‘';
                    scoresList.classList.remove('edit-mode');
                }
                
                // é‡æ–°æ¸²æŸ“æˆç»©åˆ—è¡¨ä»¥æ›´æ–°æŒ‰é’®æ˜¾ç¤º
                this.refreshScoresList();
            }

            // åˆ·æ–°æˆç»©åˆ—è¡¨
            async refreshScoresList() {
                const contestId = document.getElementById('score-entry-contest-id').value;
                const projectSelect = document.getElementById('project-select');
                
                if (contestId && projectSelect.value) {
                    await this.loadEnteredScores(contestId, projectSelect.value);
                }
            }

            bindEvents() {
                // æ ‡ç­¾é¡µåˆ‡æ¢
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = e.currentTarget.dataset.tab;
                        this.switchTab(tabName);
                    });
                });

                // æ·»åŠ æ ¡è®°å½•è¡¨å•
                const addRecordForm = document.getElementById('add-record-form');
                if (addRecordForm) {
                    addRecordForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.addRecord();
                    });
                }

                // æ·»åŠ å‘¨èµ›è¡¨å•
                const addContestForm = document.getElementById('add-contest-form');
                if (addContestForm) {
                    addContestForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.addContest();
                    });
                }
            }

            switchTab(tabName) {
                // æ›´æ–°æ ‡ç­¾çŠ¶æ€
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // æ›´æ–°å†…å®¹æ˜¾ç¤º
                document.querySelectorAll('.admin-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}-tab`).classList.add('active');

                this.currentTab = tabName;

                // åŠ è½½å¯¹åº”æ•°æ®
                if (tabName === 'records') {
                    this.loadRecords();
                } else if (tabName === 'contests') {
                    this.loadContests();
                }
            }

            // æ ¡è®°å½•ç®¡ç†åŠŸèƒ½å·²åœç”¨
            async loadRecords() {
                // åŠŸèƒ½å·²åœç”¨ - æ ¡è®°å½•æ”¹ä¸ºé™æ€æ•°æ®å±•ç¤º
                return;
                /* const recordsList = document.getElementById('records-list');
                if (!recordsList) return;

                try {
                    recordsList.innerHTML = '<div class="loading"><div class="loading"></div><p>åŠ è½½ä¸­...</p></div>';
                    
                    const response = await recordsAPI.getRecords();
                    const records = response.data || [];
                    this.records = records; // ä¿å­˜åˆ°å®ä¾‹å˜é‡
                    
                    this.renderRecords(records);
                } catch (error) {
                    recordsList.innerHTML = '<div class="error">åŠ è½½å¤±è´¥: ' + error.message + '</div>';
                } */
            }

            renderRecords(records) {
                const recordsList = document.getElementById('records-list');
                if (!recordsList) return;

                if (records.length === 0) {
                    recordsList.innerHTML = '<div class="error">æš‚æ— è®°å½•</div>';
                    return;
                }

                const tableHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>é¡¹ç›®</th>
                                <th>å§“å</th>
                                <th>å¹´çº§</th>
                                <th>å•æ¬¡</th>
                                <th>å¹³å‡</th>
                                <th>æ—¥æœŸ</th>
                                <th>æ¯”èµ›</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${records.map(record => `
                                <tr>
                                    <td>${record.project}</td>
                                    <td>${record.name}</td>
                                    <td>${record.grade}</td>
                                    <td>${record.single || '-'}</td>
                                    <td>${record.average || '-'}</td>
                                    <td>${record.date}</td>
                                    <td>${record.competition}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn btn-secondary" onclick="adminManager.editRecord('${record._id}')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-danger" onclick="adminManager.deleteRecord('${record._id}')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                recordsList.innerHTML = tableHTML;
            }

            async loadContests() {
                const contestsList = document.getElementById('contests-list');
                if (!contestsList) return;

                try {
                    contestsList.innerHTML = '<div class="loading"><div class="loading"></div><p>åŠ è½½ä¸­...</p></div>';
                    
                    const contests = await contestsAPI.getContests();
                    this.contests = contests; // ä¿å­˜åˆ°å®ä¾‹å˜é‡
                    this.renderContests(contests);
                } catch (error) {
                    contestsList.innerHTML = '<div class="error">åŠ è½½å¤±è´¥: ' + error.message + '</div>';
                }
            }

            renderContests(contests) {
                const contestsList = document.getElementById('contests-list');
                if (!contestsList) return;

                if (!contests || contests.length === 0) {
                    contestsList.innerHTML = '<div class="error">æš‚æ— è®°å½•</div>';
                    return;
                }

                const tableHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å‘¨æ¬¡</th>
                                <th>æ—¥æœŸ</th>
                                <th>é¡¹ç›®æ•°é‡</th>
                                <th>æ€»å‚èµ›äººæ•°</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${contests.map(contest => `
                                <tr>
                                    <td>${contest.week || 'æœªçŸ¥'}</td>
                                    <td>${contest.date || 'æœªçŸ¥'}</td>
                                    <td>${(contest.contests || []).length}ä¸ªé¡¹ç›®</td>
                                    <td>${this.calculateUniqueParticipants(contest)}äºº</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn btn-primary" onclick="adminManager.openScoreEntryModal('${contest._id || ''}')">
                                                <i class="fas fa-edit"></i>
                                                å½•å…¥æˆç»©
                                            </button>
                                            <button class="btn btn-secondary" onclick="adminManager.editContest('${contest._id || ''}')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-danger" onclick="adminManager.deleteContest('${contest._id || ''}')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                contestsList.innerHTML = tableHTML;
            }

            async addRecord() {
                const form = document.getElementById('add-record-form');
                const formData = new FormData(form);
                
                const recordData = {
                    project: formData.get('record-project') || document.getElementById('record-project').value,
                    name: formData.get('record-name') || document.getElementById('record-name').value,
                    grade: formData.get('record-grade') || document.getElementById('record-grade').value,
                    single: formData.get('record-single') || document.getElementById('record-single').value,
                    average: formData.get('record-average') || document.getElementById('record-average').value,
                    date: formData.get('record-date') || document.getElementById('record-date').value,
                    competition: formData.get('record-competition') || document.getElementById('record-competition').value
                };

                // åŠŸèƒ½å·²åœç”¨ - æ ¡è®°å½•æ”¹ä¸ºé™æ€æ•°æ®å±•ç¤º
                showError('æ ¡è®°å½•ç®¡ç†åŠŸèƒ½å·²åœç”¨ï¼Œè¯·ç›´æ¥ä¿®æ”¹ mockData.js æ–‡ä»¶');
                return;
                /* try {
                    await recordsAPI.createRecord(recordData);
                    form.reset();
                    this.loadRecords();
                } catch (error) {
                    // é”™è¯¯å·²åœ¨ API ä¸­å¤„ç†
                } */
            }

            async addContest() {
                const form = document.getElementById('add-contest-form');
                const formData = new FormData(form);
                
                const week = formData.get('contest-week') || document.getElementById('contest-week').value;
                const date = formData.get('contest-date') || document.getElementById('contest-date').value;
                
                // è·å–é€‰ä¸­çš„é¡¹ç›®
                const selectedProjects = [];
                const projectCheckboxes = form.querySelectorAll('input[name="contest-projects"]:checked');
                projectCheckboxes.forEach(checkbox => {
                    selectedProjects.push(checkbox.value);
                });
                
                // éªŒè¯å¿…è¦å‚æ•°
                if (!week || !date) {
                    showError('è¯·å¡«å†™å‘¨æ¬¡å’Œæ—¥æœŸ');
                    return;
                }
                
                if (selectedProjects.length === 0) {
                    showError('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªé¡¹ç›®');
                    return;
                }
                
                // ä¸ºæ¯ä¸ªé€‰ä¸­çš„é¡¹ç›®åˆ›å»ºæ¯”èµ›æ•°æ®
                const contests = selectedProjects.map(project => ({
                    project: project,
                    results: [] // åˆå§‹ä¸ºç©ºæ•°ç»„ï¼Œåç»­å¯ä»¥æ·»åŠ é€‰æ‰‹æˆç»©
                }));
                
                const contestData = {
                    week: week,
                    date: date,
                    contests: contests
                };

                try {
                    await contestsAPI.createContest(contestData);
                    showSuccess(`å‘¨èµ›è®°å½•åˆ›å»ºæˆåŠŸï¼åŒ…å« ${selectedProjects.length} ä¸ªé¡¹ç›®ï¼š${selectedProjects.join('ã€')}`);
                    form.reset();
                    this.loadContests();
                } catch (error) {
                    // é”™è¯¯å·²åœ¨ API ä¸­å¤„ç†
                }
            }

            async editRecord(id) {
                showError('ç¼–è¾‘åŠŸèƒ½å¼€å‘ä¸­');
            }

            async deleteRecord(id) {
                // åŠŸèƒ½å·²åœç”¨ - æ ¡è®°å½•æ”¹ä¸ºé™æ€æ•°æ®å±•ç¤º
                showError('æ ¡è®°å½•ç®¡ç†åŠŸèƒ½å·²åœç”¨ï¼Œè¯·ç›´æ¥ä¿®æ”¹ mockData.js æ–‡ä»¶');
                return;
                /* if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                    try {
                        await recordsAPI.deleteRecord(id);
                        this.loadRecords();
                    } catch (error) {
                        // é”™è¯¯å·²åœ¨ API ä¸­å¤„ç†
                    }
                } */
            }

            async editContest(id) {
                try {
                    // æŸ¥æ‰¾å‘¨èµ›æ•°æ®
                    const contest = this.contests.find(c => c._id === id);
                    if (!contest) {
                        showError('å‘¨èµ›è®°å½•ä¸å­˜åœ¨');
                        return;
                    }

                    // æ‰“å¼€ç¼–è¾‘æ¨¡æ€æ¡†
                    this.openContestEditModal(contest);
                } catch (error) {
                    console.error('ç¼–è¾‘å‘¨èµ›å¤±è´¥:', error);
                    showError('ç¼–è¾‘å‘¨èµ›å¤±è´¥: ' + error.message);
                }
            }

            // æ‰“å¼€å‘¨èµ›ç¼–è¾‘æ¨¡æ€æ¡†
            openContestEditModal(contest) {
                const modal = document.getElementById('contest-edit-modal');
                const weekElement = document.getElementById('contest-edit-week');
                const dateElement = document.getElementById('contest-edit-date');
                const contestIdInput = document.getElementById('contest-edit-id');
                const weekInput = document.getElementById('edit-week');
                const dateInput = document.getElementById('edit-date');

                // è®¾ç½®åŸºæœ¬ä¿¡æ¯
                weekElement.textContent = contest.week || 'æœªçŸ¥å‘¨æ¬¡';
                dateElement.textContent = contest.date || 'æœªçŸ¥æ—¥æœŸ';
                contestIdInput.value = contest._id || '';
                weekInput.value = contest.week || '';
                
                // è®¾ç½®æ—¥æœŸï¼ˆè½¬æ¢ä¸ºYYYY-MM-DDæ ¼å¼ï¼‰
                if (contest.date) {
                    const date = new Date(contest.date);
                    if (!isNaN(date.getTime())) {
                        dateInput.value = date.toISOString().split('T')[0];
                    }
                }

                // æ¸²æŸ“é¡¹ç›®åˆ—è¡¨
                this.renderContestProjects(contest);

                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                modal.classList.add('show');
            }

            // æ¸²æŸ“å‘¨èµ›é¡¹ç›®åˆ—è¡¨
            renderContestProjects(contest) {
                const projectsList = document.getElementById('projects-list');
                const contests = contest.contests || [];

                if (contests.length === 0) {
                    projectsList.innerHTML = '<div class="no-data">æš‚æ— é¡¹ç›®</div>';
                    return;
                }

                projectsList.innerHTML = contests.map(contest => {
                    // è®¡ç®—è¯¥é¡¹ç›®çš„å”¯ä¸€å‚èµ›äººæ•°
                    const uniqueParticipants = new Set();
                    if (contest.results && Array.isArray(contest.results)) {
                        contest.results.forEach(result => {
                            if (result.name && result.name.trim()) {
                                uniqueParticipants.add(result.name.trim());
                            }
                        });
                    }
                    
                    return `
                        <div class="project-item" data-project="${contest.project}">
                            <div class="project-info">
                                <div class="project-name">${contest.project}</div>
                                <div class="project-stats">
                                    å‚èµ›äººæ•°: ${uniqueParticipants.size}äºº
                                </div>
                            </div>
                            <div class="project-actions">
                                <!-- çœ¼ç›æŒ‰é’®å·²éšè— -->
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // æŸ¥çœ‹é¡¹ç›®æˆç»©
            viewProjectScores(project) {
                // è¿™é‡Œå¯ä»¥æ‰“å¼€ä¸€ä¸ªæŸ¥çœ‹æˆç»©çš„æ¨¡æ€æ¡†
                showError('æŸ¥çœ‹æˆç»©åŠŸèƒ½å¼€å‘ä¸­');
            }

            // æ›´æ–°å‘¨èµ›æ•°æ®
            async updateContestData(contestId, updatedData) {
                try {
                    // è°ƒç”¨APIæ›´æ–°å‘¨èµ›
                    await contestsAPI.updateContest(contestId, updatedData);
                    
                    // é‡æ–°åŠ è½½å‘¨èµ›åˆ—è¡¨
                    await this.loadContests();
                    
                    // å…³é—­ç¼–è¾‘æ¨¡æ€æ¡†
                    closeContestEditModal();
                    
                    showSuccess('å‘¨èµ›æ›´æ–°æˆåŠŸ');
                } catch (error) {
                    console.error('æ›´æ–°å‘¨èµ›å¤±è´¥:', error);
                    showError('æ›´æ–°å‘¨èµ›å¤±è´¥: ' + error.message);
                }
            }

            async deleteContest(id) {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å‘¨èµ›è®°å½•å—ï¼Ÿ')) {
                    try {
                        await contestsAPI.deleteContest(id);
                        this.loadContests();
                    } catch (error) {
                        // é”™è¯¯å·²åœ¨ API ä¸­å¤„ç†
                    }
                }
            }

            // æ‰“å¼€æˆç»©å½•å…¥æ¨¡æ€æ¡†
            async openScoreEntryModal(contestId) {
                try {
                    // è·å–å‘¨èµ›æ•°æ®
                    const contests = await contestsAPI.getContests();
                    const contest = contests.find(c => c._id === contestId);
                    
                    if (!contest) {
                        showError('å‘¨èµ›è®°å½•ä¸å­˜åœ¨');
                        return;
                    }

                    // è®¾ç½®æ¨¡æ€æ¡†ä¿¡æ¯
                    document.getElementById('score-entry-week').textContent = contest.week;
                    document.getElementById('score-entry-date').textContent = contest.date;
                    document.getElementById('score-entry-contest-id').value = contestId;

                    // ç”Ÿæˆé¡¹ç›®é€‰æ‹©ä¸‹æ‹‰æ¡†
                    this.renderProjectSelect(contest);

                    // åŠ è½½å·²å½•å…¥çš„æˆç»©
                    await this.loadEnteredScores(contestId, contest.contests[0]?.project || '');

                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    const modal = document.getElementById('score-entry-modal');
                    modal.classList.add('show');
                } catch (error) {
                    showError('æ‰“å¼€æˆç»©å½•å…¥å¤±è´¥: ' + error.message);
                }
            }

            // æ¸²æŸ“é¡¹ç›®é€‰æ‹©ä¸‹æ‹‰æ¡†
            renderProjectSelect(contest) {
                const projectSelect = document.getElementById('project-select');
                projectSelect.innerHTML = '';
                
                contest.contests.forEach(project => {
                    const option = document.createElement('option');
                    option.value = project.project;
                    
                    // æ˜¾ç¤ºé¡¹ç›®åç§°å’Œé…ç½®ä¿¡æ¯
                    const config = getProjectConfig(project.project);
                    option.textContent = `${config.displayName} (${config.attempts}æŠŠ - ${this.getScoringMethodDisplay(config.scoringMethod)})`;
                    projectSelect.appendChild(option);
                });
                
                // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªé¡¹ç›®
                if (contest.contests.length > 0) {
                    projectSelect.value = contest.contests[0].project;
                    // æ›´æ–°é¡¹ç›®ä¿¡æ¯æ˜¾ç¤º
                    this.updateProjectInfo(contest.contests[0].project);
                    this.updateTimesInputPlaceholder(contest.contests[0].project);
                }
            }

            // åŠ è½½å·²å½•å…¥çš„æˆç»©
            async loadEnteredScores(contestId, project) {
                try {
                    const contests = await contestsAPI.getContests();
                    const contest = contests.find(c => c._id === contestId);
                    
                    if (!contest) return;
                    
                    const projectData = contest.contests.find(c => c.project === project);
                    const results = projectData ? projectData.results || [] : [];
                    
                    this.renderEnteredScores(results);
                } catch (error) {
                    console.error('åŠ è½½å·²å½•å…¥æˆç»©å¤±è´¥:', error);
                    this.renderEnteredScores([]);
                }
            }

            // æ¸²æŸ“å·²å½•å…¥çš„æˆç»©åˆ—è¡¨
            renderEnteredScores(results) {
                const scoresList = document.getElementById('entered-scores-list');
                
                if (results.length === 0) {
                    scoresList.innerHTML = `
                        <div style="padding: var(--spacing-lg); text-align: center; color: var(--text-secondary);">
                            <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: var(--spacing-sm); display: block;"></i>
                            <p>æš‚æ— å·²å½•å…¥çš„æˆç»©</p>
                        </div>
                    `;
                    return;
                }
                
                // æŒ‰æäº¤æ—¶é—´æ’åºï¼Œæœ€æ–°çš„åœ¨ä¸Šé¢
                const sortedResults = [...results].sort((a, b) => {
                    const timeA = new Date(a.submittedAt || a.enteredAt || 0);
                    const timeB = new Date(b.submittedAt || b.enteredAt || 0);
                    return timeB - timeA;
                });
                
                scoresList.innerHTML = sortedResults.map((result, index) => this.generateScoreItem(result, index)).join('');
            }

            // ç”Ÿæˆæˆç»©é¡¹HTML
            generateScoreItem(result, index) {
                const times = result.times || [];
                
                // è·å–å½“å‰é€‰æ‹©çš„é¡¹ç›®ç±»å‹
                const projectSelect = document.getElementById('project-select');
                const projectName = projectSelect ? projectSelect.value : '';
                const config = getProjectConfig(projectName);
                
                // å¯¹æˆç»©è¿›è¡Œæ’åºï¼ŒDNFæ’æœ€åï¼Œå…¶ä»–æŒ‰æ—¶é—´æ’åº
                const sortedTimes = [...times].sort((a, b) => {
                    // å¦‚æœéƒ½æ˜¯å¯¹è±¡ï¼ˆå¸¦çŠ¶æ€ï¼‰ï¼ŒæŒ‰æ—¶é—´æ’åº
                    if (typeof a === 'object' && typeof b === 'object') {
                        if (a.status === 'dnf' && b.status === 'dnf') return 0;
                        if (a.status === 'dnf') return 1;
                        if (b.status === 'dnf') return -1;
                        return (a.time || 0) - (b.time || 0);
                    }
                    // å…¼å®¹æ—§æ ¼å¼
                    const timeA = typeof a === 'string' ? parseFloat(a.replace(':', '.')) : a;
                    const timeB = typeof b === 'string' ? parseFloat(b.replace(':', '.')) : b;
                    return timeA - timeB;
                });
                
                // æ ¼å¼åŒ–æäº¤æ—¶é—´
                const submittedAt = result.submittedAt ? new Date(result.submittedAt) : new Date();
                const timeStr = submittedAt.toLocaleString('zh-CN', {
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                return `
                    <div class="score-item" data-index="${index}">
                        <div class="score-info">
                            <div class="score-player">
                                <div class="player-name">${result.name}</div>
                                <div class="player-meta">
                                    <span class="round-badge">ç¬¬${result.round || 1}è½®</span>
                                </div>
                            </div>
                            <div class="score-times">
                                ${times.map(time => {
                                    // åªæœ‰AO5é¡¹ç›®æ‰æ ‡è®°æœ€å¥½å’Œæœ€å·®æˆç»©
                                    const isBest = config.scoringMethod === 'ao5' && time === sortedTimes[0] && 
                                                  !(typeof time === 'object' && time.status === 'dnf');
                                    const isWorst = config.scoringMethod === 'ao5' && time === sortedTimes[sortedTimes.length - 1] && 
                                                   sortedTimes.filter(t => !(typeof t === 'object' && t.status === 'dnf')).length > 1;
                                    
                                    // å¤„ç†å¸¦çŠ¶æ€çš„æˆç»©æ˜¾ç¤º
                                    let displayTime = '';
                                    if (typeof time === 'object' && time.status) {
                                        displayTime = time.display;
                                    } else {
                                        // å…¼å®¹æ—§æ ¼å¼
                                        displayTime = this.formatTime(time, projectName);
                                    }
                                    
                                    // åªæœ‰å»å¤´å°¾å¹³å‡ï¼ˆAO5ï¼‰æ‰åŠ æ‹¬å·
                                    if (config.scoringMethod === 'ao5' && (isBest || isWorst)) {
                                        displayTime = `(${displayTime})`;
                                    }
                                    
                                    // åªæœ‰AO5é¡¹ç›®æ‰åº”ç”¨best/worstæ ·å¼
                                    const rankClass = config.scoringMethod === 'ao5' ? 
                                                    (isBest ? 'best' : isWorst ? 'worst' : '') : '';
                                    
                                    return `
                                        <span class="score-time ${rankClass}">
                                            ${displayTime}
                                        </span>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        <div class="score-actions">
                            ${this.editMode ? `
                                <button class="btn btn-sm btn-outline" onclick="editScore(${index})" title="ç¼–è¾‘æˆç»©">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteScore(${index})" title="åˆ é™¤æˆç»©">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : `
                                <button class="btn btn-sm btn-outline" onclick="editScore(${index})" title="ç¼–è¾‘æˆç»©" style="opacity: 0;">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteScore(${index})" title="åˆ é™¤æˆç»©" style="opacity: 0;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            `}
                        </div>
                    </div>
                `;
            }

            // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤ºï¼ˆä½¿ç”¨æ–°çš„æ—¶é—´å·¥å…·ï¼‰
            formatTime(time, projectName) {
                const config = getProjectConfig(projectName);
                return formatTimeDisplay(time, config.timeFormat === 'moves');
            }

            // æ¸²æŸ“é¡¹ç›®æ ‡ç­¾é¡µ
            renderProjectTabs(contest) {
                const projectTabs = document.getElementById('project-tabs');
                const projectContent = document.getElementById('project-content');
                
                // æ¸…ç©ºå†…å®¹
                projectTabs.innerHTML = '';
                projectContent.innerHTML = '';

                // ç”Ÿæˆæ ‡ç­¾é¡µ
                contest.contests.forEach((project, index) => {
                    const tabId = `project-tab-${index}`;
                    const panelId = `project-panel-${index}`;
                    
                    // åˆ›å»ºæ ‡ç­¾
                    const tab = document.createElement('div');
                    tab.className = `project-tab ${index === 0 ? 'active' : ''}`;
                    tab.id = tabId;
                    tab.textContent = project.project;
                    tab.onclick = () => this.switchProjectTab(index);
                    projectTabs.appendChild(tab);

                    // åˆ›å»ºå†…å®¹é¢æ¿
                    const panel = document.createElement('div');
                    panel.className = `project-panel ${index === 0 ? 'active' : ''}`;
                    panel.id = panelId;
                    panel.innerHTML = `
                        <h4>
                            <i class="fas fa-cube"></i>
                            ${project.project} æˆç»©å½•å…¥
                        </h4>
                        <form class="score-entry-form" data-project="${project.project}">
                            <div class="form-group">
                                <label>å‚èµ›é€‰æ‰‹æˆç»©</label>
                                <div class="player-inputs">
                                    ${this.generatePlayerInputs(project.results || [])}
                                </div>
                                <button type="button" class="btn btn-outline" onclick="addPlayerInputToProject('${project.project}')">
                                    <i class="fas fa-plus"></i>
                                    æ·»åŠ é€‰æ‰‹
                                </button>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    ä¿å­˜æˆç»©
                                </button>
                            </div>
                        </form>
                    `;
                    projectContent.appendChild(panel);
                });
            }

            // ç”Ÿæˆé€‰æ‰‹è¾“å…¥æ¡†
            generatePlayerInputs(results) {
                if (results && results.length > 0) {
                    return results.map((result, index) => this.generatePlayerInputGroup(result.name, result.times, index)).join('');
                } else {
                    // é»˜è®¤æ·»åŠ 3ä¸ªç©ºè¾“å…¥æ¡†
                    let html = '';
                    for (let i = 0; i < 3; i++) {
                        html += this.generatePlayerInputGroup('', [], i);
                    }
                    return html;
                }
            }

            // ç”Ÿæˆå•ä¸ªé€‰æ‰‹è¾“å…¥ç»„
            generatePlayerInputGroup(name = '', times = [], index = 0) {
                return `
                    <div class="player-input-group">
                        <input type="text" placeholder="é€‰æ‰‹å§“å" value="${name}" class="form-control player-name">
                        <input type="text" placeholder="æˆç»©1" value="${times[0] || ''}" class="form-control player-time">
                        <input type="text" placeholder="æˆç»©2" value="${times[1] || ''}" class="form-control player-time">
                        <input type="text" placeholder="æˆç»©3" value="${times[2] || ''}" class="form-control player-time">
                        <input type="text" placeholder="æˆç»©4" value="${times[3] || ''}" class="form-control player-time">
                        <input type="text" placeholder="æˆç»©5" value="${times[4] || ''}" class="form-control player-time">
                        <button type="button" class="btn btn-danger" onclick="removePlayerInput(this)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            }

            // åˆ‡æ¢é¡¹ç›®æ ‡ç­¾é¡µ
            switchProjectTab(index) {
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.project-tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.project-panel').forEach(panel => panel.classList.remove('active'));
                
                // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾å’Œé¢æ¿
                document.getElementById(`project-tab-${index}`).classList.add('active');
                document.getElementById(`project-panel-${index}`).classList.add('active');
            }

            // æ·»åŠ é€‰æ‰‹è¾“å…¥æ¡†
            addPlayerInput(projectName) {
                const activePanel = document.querySelector('.project-panel.active');
                if (activePanel) {
                    const playerInputs = activePanel.querySelector('.player-inputs');
                    if (playerInputs) {
                        const newInputGroup = this.generatePlayerInputGroup('', [], playerInputs.children.length);
                        playerInputs.insertAdjacentHTML('beforeend', newInputGroup);
                    }
                }
            }

            // è®¡ç®—å”¯ä¸€å‚èµ›äººæ•°
            calculateUniqueParticipants(contest) {
                if (!contest || !contest.contests) return 0;
                
                const allParticipants = new Set();
                
                // éå†æ‰€æœ‰é¡¹ç›®ï¼Œæ”¶é›†æ‰€æœ‰ä¸åŒçš„é€‰æ‰‹åå­—
                contest.contests.forEach(project => {
                    if (project.results && Array.isArray(project.results)) {
                        project.results.forEach(result => {
                            if (result.name && result.name.trim()) {
                                allParticipants.add(result.name.trim());
                            }
                        });
                    }
                });
                
                return allParticipants.size;
            }

            // éªŒè¯æˆç»©æ ¼å¼ï¼ˆä½¿ç”¨æ–°çš„æ—¶é—´å·¥å…·ï¼‰
            validateTimesFormat(timesInput, projectName) {
                if (!timesInput.trim()) {
                    return { valid: false, message: 'è¯·è¾“å…¥æˆç»©' };
                }
                
                const config = getProjectConfig(projectName);
                
                // è§£ææˆç»©
                const times = timesInput.split(/\s+/).filter(time => time.trim());
                if (times.length === 0) {
                    return { valid: false, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„æˆç»©' };
                }
                
                // æ£€æŸ¥æˆç»©æ•°é‡
                if (times.length > config.attempts) {
                    return { valid: false, message: `${projectName}æœ€å¤šåªèƒ½è¾“å…¥${config.attempts}ä¸ªæˆç»©` };
                }
                
                // è§£ææ¯ä¸ªæˆç»©
                const parsedTimes = [];
                for (let i = 0; i < times.length; i++) {
                    const time = times[i].trim();
                    if (!time) continue;
                    
                    const parsed = validateTimeForProject(time, projectName);
                    if (!parsed.valid) {
                        return { valid: false, message: `ç¬¬${i + 1}ä¸ªæˆç»©æ ¼å¼æ— æ•ˆï¼š${parsed.error}` };
                    }
                    parsedTimes.push(parsed);
                }
                
                return { valid: true, times: parsedTimes };
            }


            // å¿«é€Ÿå½•å…¥æˆç»©
            async quickAddScore() {
                const playerName = document.getElementById('player-name-input').value.trim();
                const timesInput = document.getElementById('times-input').value.trim();
                const roundInput = document.getElementById('round-input').value;
                const projectSelect = document.getElementById('project-select');
                const contestId = document.getElementById('score-entry-contest-id').value;
                const projectName = projectSelect.value;
                
                if (!playerName) {
                    showError('è¯·è¾“å…¥é€‰æ‰‹å§“å');
                    return;
                }
                
                if (!projectName) {
                    showError('è¯·é€‰æ‹©é¡¹ç›®');
                    return;
                }
                
                // éªŒè¯æˆç»©æ ¼å¼ï¼ˆä¼ å…¥é¡¹ç›®åç§°ï¼‰
                const validation = this.validateTimesFormat(timesInput, projectName);
                if (!validation.valid) {
                    showError(validation.message);
                    return;
                }
                
                const parsedTimes = validation.times;
                
                try {
                    // è·å–å½“å‰é¡¹ç›®çš„æ‰€æœ‰æˆç»©
                    const contests = await contestsAPI.getContests();
                    const contest = contests.find(c => c._id === contestId);
                    const projectData = contest.contests.find(c => c.project === projectSelect.value);
                    const currentResults = projectData ? projectData.results || [] : [];
                    
                    // æ£€æŸ¥é€‰æ‰‹æ˜¯å¦å·²å­˜åœ¨ï¼ˆåŒä¸€è½®æ¬¡ï¼‰
                    const existingIndex = currentResults.findIndex(r => r.name === playerName && r.round == roundInput);
                    const newResult = {
                        name: playerName,
                        times: parsedTimes,
                        round: parseInt(roundInput),
                        submittedAt: new Date().toISOString(),
                        submittedBy: 'admin'
                    };
                    
                    if (existingIndex >= 0) {
                        // æ›´æ–°ç°æœ‰é€‰æ‰‹
                        currentResults[existingIndex] = newResult;
                    } else {
                        // æ·»åŠ æ–°é€‰æ‰‹
                        currentResults.push(newResult);
                    }
                    
                    // æäº¤åˆ°æ•°æ®åº“
                    await contestScoresAPI.submitScores(contestId, projectSelect.value, currentResults);
                    
                    // æ¸…ç©ºè¾“å…¥æ¡†
                    document.getElementById('player-name-input').value = '';
                    document.getElementById('times-input').value = '';
                    
                    // åˆ·æ–°å·²å½•å…¥æˆç»©åˆ—è¡¨
                    await this.loadEnteredScores(contestId, projectSelect.value);
                    
                    showSuccess('æˆç»©å½•å…¥æˆåŠŸ');
                } catch (error) {
                    showError('å½•å…¥æˆç»©å¤±è´¥: ' + error.message);
                }
            }

            // ç¼–è¾‘æˆç»©
            editScore(index) {
                const scoreItem = document.querySelector(`[data-index="${index}"]`);
                if (!scoreItem) return;
                
                const scoreInfo = scoreItem.querySelector('.score-info');
                const scoreActions = scoreItem.querySelector('.score-actions');
                
                // è·å–å½“å‰æ•°æ®
                const playerName = scoreInfo.querySelector('.player-name').textContent;
                const roundBadge = scoreInfo.querySelector('.round-badge');
                const currentRound = roundBadge ? roundBadge.textContent.match(/\d+/)[0] : '1';
                
                // è·å–æˆç»©æ•°æ®ï¼ˆæ”¯æŒçŠ¶æ€æ ¼å¼ï¼‰
                const times = Array.from(scoreInfo.querySelectorAll('.score-time')).map(span => {
                    const text = span.textContent.replace(/[()]/g, '').trim();
                    return text;
                });
                
                // åˆ›å»ºç¼–è¾‘è¡¨å•
                const editForm = document.createElement('div');
                editForm.className = 'score-edit-form';
                editForm.innerHTML = `
                    <input type="text" class="player-name-edit" value="${playerName}" placeholder="é€‰æ‰‹å§“å">
                    <select class="round-edit">
                        <option value="1" ${currentRound == 1 ? 'selected' : ''}>ç¬¬1è½®</option>
                        <option value="2" ${currentRound == 2 ? 'selected' : ''}>ç¬¬2è½®</option>
                        <option value="3" ${currentRound == 3 ? 'selected' : ''}>ç¬¬3è½®</option>
                    </select>
                    <input type="text" class="times-edit" value="${times.join(' ')}" placeholder="æˆç»©ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼‰">
                                    <small class="form-text text-muted">
                                        æ‚¬åœå½•å…¥æŒ‰é’®æ—çš„å¸®åŠ©å›¾æ ‡æŸ¥çœ‹æ ¼å¼
                                    </small>
                    <button class="btn btn-sm btn-primary" onclick="saveScoreEdit(${index})">
                        <i class="fas fa-save"></i>
                    </button>
                    <button class="btn btn-sm btn-secondary" onclick="cancelScoreEdit(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                // æ›¿æ¢å†…å®¹
                scoreItem.classList.add('editing');
                scoreInfo.style.display = 'none';
                scoreActions.style.display = 'none';
                scoreItem.insertBefore(editForm, scoreActions);
            }

            // ä¿å­˜æˆç»©ç¼–è¾‘
            async saveScoreEdit(index) {
                const scoreItem = document.querySelector(`[data-index="${index}"]`);
                if (!scoreItem) return;
                
                const editForm = scoreItem.querySelector('.score-edit-form');
                const playerName = editForm.querySelector('.player-name-edit').value.trim();
                const timesInput = editForm.querySelector('.times-edit').value.trim();
                const roundInput = editForm.querySelector('.round-edit').value;
                const projectSelect = document.getElementById('project-select');
                const contestId = document.getElementById('score-entry-contest-id').value;
                
                if (!playerName) {
                    showError('è¯·è¾“å…¥é€‰æ‰‹å§“å');
                    return;
                }
                
                // éªŒè¯æˆç»©æ ¼å¼ï¼ˆä¼ å…¥é¡¹ç›®åç§°ï¼‰
                const validation = this.validateTimesFormat(timesInput, projectSelect.value);
                if (!validation.valid) {
                    showError(validation.message);
                    return;
                }
                
                const parsedTimes = validation.times;
                
                try {
                    // è·å–å½“å‰é¡¹ç›®çš„æ‰€æœ‰æˆç»©
                    const contests = await contestsAPI.getContests();
                    const contest = contests.find(c => c._id === contestId);
                    const projectData = contest.contests.find(c => c.project === projectSelect.value);
                    const currentResults = projectData ? projectData.results || [] : [];
                    
                    // æ›´æ–°æˆç»©
                    if (index < currentResults.length) {
                        currentResults[index] = {
                            name: playerName,
                            times: parsedTimes,
                            round: parseInt(roundInput),
                            submittedAt: new Date().toISOString(),
                            submittedBy: 'admin'
                        };
                        
                        // æäº¤åˆ°æ•°æ®åº“
                        await contestScoresAPI.submitScores(contestId, projectSelect.value, currentResults);
                        
                        // åˆ·æ–°å·²å½•å…¥æˆç»©åˆ—è¡¨
                        await this.loadEnteredScores(contestId, projectSelect.value);
                        
                        showSuccess('æˆç»©æ›´æ–°æˆåŠŸ');
                    }
                } catch (error) {
                    showError('æ›´æ–°æˆç»©å¤±è´¥: ' + error.message);
                }
            }

            // å–æ¶ˆæˆç»©ç¼–è¾‘
            cancelScoreEdit(index) {
                const scoreItem = document.querySelector(`[data-index="${index}"]`);
                if (!scoreItem) return;
                
                // æ¢å¤åŸå§‹æ˜¾ç¤º
                scoreItem.classList.remove('editing');
                scoreItem.querySelector('.score-info').style.display = 'flex';
                scoreItem.querySelector('.score-actions').style.display = 'flex';
                scoreItem.querySelector('.score-edit-form').remove();
            }

            // åˆ é™¤æˆç»©
            async deleteScore(index) {
                if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æˆç»©è®°å½•å—ï¼Ÿ')) return;
                
                const projectSelect = document.getElementById('project-select');
                const contestId = document.getElementById('score-entry-contest-id').value;
                
                try {
                    // è·å–å½“å‰é¡¹ç›®çš„æ‰€æœ‰æˆç»©
                    const contests = await contestsAPI.getContests();
                    const contest = contests.find(c => c._id === contestId);
                    const projectData = contest.contests.find(c => c.project === projectSelect.value);
                    const currentResults = projectData ? projectData.results || [] : [];
                    
                    // åˆ é™¤æŒ‡å®šæˆç»©
                    if (index < currentResults.length) {
                        currentResults.splice(index, 1);
                        
                        // æäº¤åˆ°æ•°æ®åº“
                        await contestScoresAPI.submitScores(contestId, projectSelect.value, currentResults);
                        
                        // åˆ·æ–°å·²å½•å…¥æˆç»©åˆ—è¡¨
                        await this.loadEnteredScores(contestId, projectSelect.value);
                        
                        showSuccess('æˆç»©åˆ é™¤æˆåŠŸ');
                    }
                } catch (error) {
                    showError('åˆ é™¤æˆç»©å¤±è´¥: ' + error.message);
                }
            }

            // ä¿å­˜é¡¹ç›®æˆç»©
            async saveProjectScores(form) {
                const projectName = form.dataset.project;
                const contestId = document.getElementById('score-entry-contest-id').value;
                
                if (!contestId) {
                    showError('å‘¨èµ›IDä¸å­˜åœ¨');
                    return;
                }
                
                // æ”¶é›†é€‰æ‰‹æ•°æ®
                const players = [];
                const playerGroups = form.querySelectorAll('.player-input-group');
                
                playerGroups.forEach(group => {
                    const nameInput = group.querySelector('.player-name');
                    const timeInputs = group.querySelectorAll('.player-time');
                    
                    const name = nameInput.value.trim();
                    if (!name) return; // è·³è¿‡æ²¡æœ‰å§“åçš„é€‰æ‰‹
                    
                    const times = [];
                    timeInputs.forEach(input => {
                        const time = input.value.trim();
                        if (time) times.push(time);
                    });
                    
                    players.push({
                        name: name,
                        times: times
                    });
                });

                if (players.length === 0) {
                    showError('è¯·è‡³å°‘å½•å…¥ä¸€ä¸ªé€‰æ‰‹çš„æˆç»©');
                    return;
                }

                try {
                    // ç›´æ¥æäº¤æˆç»©
                    await contestScoresAPI.submitScores(contestId, projectName, players);
                    this.loadContests(); // é‡æ–°åŠ è½½åˆ—è¡¨
                    closeScoreEntryModal(); // å…³é—­æ¨¡æ€æ¡†
                } catch (error) {
                    showError('ä¿å­˜æˆç»©å¤±è´¥: ' + error.message);
                }
            }

            // æ¸²æŸ“é€‰æ‰‹è¾“å…¥æ¡†
            renderPlayerInputs(results) {
                const container = document.getElementById('score-entry-players');
                container.innerHTML = '';

                // å¦‚æœæœ‰ç°æœ‰æˆç»©ï¼Œæ˜¾ç¤ºå®ƒä»¬
                if (results && results.length > 0) {
                    results.forEach((result, index) => {
                        this.addPlayerInput(result.name, result.times, index);
                    });
                } else {
                    // é»˜è®¤æ·»åŠ 3ä¸ªç©ºè¾“å…¥æ¡†
                    for (let i = 0; i < 3; i++) {
                        this.addPlayerInput('', [], i);
                    }
                }
            }

            // æ·»åŠ é€‰æ‰‹è¾“å…¥æ¡†
            addPlayerInput(name = '', times = [], index = null) {
                const container = document.getElementById('score-entry-players');
                const playerIndex = index !== null ? index : container.children.length;
                
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-input-group';
                playerDiv.innerHTML = `
                    <input type="text" placeholder="é€‰æ‰‹å§“å" value="${name}" class="form-control player-name" data-index="${playerIndex}">
                    <input type="text" placeholder="æˆç»©1" value="${times[0] || ''}" class="form-control player-time" data-index="${playerIndex}" data-time="0">
                    <input type="text" placeholder="æˆç»©2" value="${times[1] || ''}" class="form-control player-time" data-index="${playerIndex}" data-time="1">
                    <input type="text" placeholder="æˆç»©3" value="${times[2] || ''}" class="form-control player-time" data-index="${playerIndex}" data-time="2">
                    <input type="text" placeholder="æˆç»©4" value="${times[3] || ''}" class="form-control player-time" data-index="${playerIndex}" data-time="3">
                    <input type="text" placeholder="æˆç»©5" value="${times[4] || ''}" class="form-control player-time" data-index="${playerIndex}" data-time="4">
                    <button type="button" class="btn btn-danger" onclick="removePlayerInput(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                container.appendChild(playerDiv);
            }

            // ä¿å­˜æˆç»©
            async saveScores() {
                const contestId = document.getElementById('score-entry-contest-id').value;
                const projectName = document.getElementById('score-entry-project-name').value;
                
                // æ”¶é›†æ‰€æœ‰é€‰æ‰‹æ•°æ®
                const players = [];
                const playerGroups = document.querySelectorAll('.player-input-group');
                
                playerGroups.forEach(group => {
                    const nameInput = group.querySelector('.player-name');
                    const timeInputs = group.querySelectorAll('.player-time');
                    
                    const name = nameInput.value.trim();
                    if (!name) return; // è·³è¿‡æ²¡æœ‰å§“åçš„é€‰æ‰‹
                    
                    const times = [];
                    timeInputs.forEach(input => {
                        const time = input.value.trim();
                        if (time) times.push(time);
                    });
                    
                    if (times.length > 0) {
                        players.push({
                            name: name,
                            times: times
                        });
                    }
                });

                if (players.length === 0) {
                    showError('è¯·è‡³å°‘å½•å…¥ä¸€ä¸ªé€‰æ‰‹çš„æˆç»©');
                    return;
                }

                try {
                    // è¿™é‡Œéœ€è¦è°ƒç”¨APIæ›´æ–°å‘¨èµ›è®°å½•
                    // ç”±äºå½“å‰æ˜¯æ¨¡æ‹Ÿæ•°æ®ï¼Œæˆ‘ä»¬ç›´æ¥æ›´æ–°æœ¬åœ°æ˜¾ç¤º
                    showSuccess(`æˆåŠŸå½•å…¥ ${players.length} åé€‰æ‰‹çš„æˆç»©`);
                    this.closeScoreEntryModal();
                    this.loadContests(); // é‡æ–°åŠ è½½åˆ—è¡¨
                } catch (error) {
                    showError('ä¿å­˜æˆç»©å¤±è´¥: ' + error.message);
                }
            }
        }


        // åˆ‡æ¢æ›´å¤šé¡¹ç›®æ˜¾ç¤º
        function toggleMoreProjects() {
            const moreProjects = document.getElementById('more-projects');
            const toggleBtn = document.querySelector('.more-projects-toggle .btn');
            const icon = document.getElementById('more-projects-icon');
            const text = document.getElementById('more-projects-text');
            const toggleContainer = document.querySelector('.more-projects-toggle');
            
            if (moreProjects.classList.contains('hidden') || moreProjects.style.display === 'none') {
                // å±•å¼€
                moreProjects.style.display = 'block';
                moreProjects.classList.remove('hidden');
                moreProjects.classList.add('visible');
                
                // ç«‹å³æ›´æ–°æŒ‰é’®çŠ¶æ€
                toggleBtn.classList.add('expanded');
                icon.className = 'fas fa-chevron-up';
                text.textContent = 'æ”¶èµ·';
                
                // å°†æŒ‰é’®ç§»åŠ¨åˆ°éšè—é¡¹ç›®åŒºåŸŸçš„æœ€å
                const hiddenRow = moreProjects.querySelector('.checkbox-row');
                if (hiddenRow && toggleContainer) {
                    hiddenRow.appendChild(toggleContainer);
                }
            } else {
                // æ”¶èµ·
                moreProjects.classList.remove('visible');
                moreProjects.classList.add('hidden');
                
                // ç«‹å³æ›´æ–°æŒ‰é’®çŠ¶æ€
                toggleBtn.classList.remove('expanded');
                icon.className = 'fas fa-chevron-down';
                text.textContent = 'æ›´å¤š';
                
                // å»¶è¿Ÿéšè—å…ƒç´ ï¼Œç¡®ä¿åŠ¨ç”»å®Œæˆ
                setTimeout(() => {
                    moreProjects.style.display = 'none';
                }, 300);
                
                // å°†æŒ‰é’®ç§»å›åŸä½ç½®ï¼ˆSQ1é¡¹ç›®æ—è¾¹ï¼‰
                const sq1Checkbox = document.querySelector('input[value="SQ1"]');
                if (sq1Checkbox && toggleContainer) {
                    const sq1Row = sq1Checkbox.closest('.checkbox-row');
                    if (sq1Row) {
                        sq1Row.appendChild(toggleContainer);
                    }
                }
            }
        }

        // æ·»åŠ é€‰æ‰‹è¾“å…¥æ¡†
        function addPlayerInput(projectName) {
            if (window.adminManager) {
                window.adminManager.addPlayerInput(projectName);
            }
        }

        // æ·»åŠ é€‰æ‰‹è¾“å…¥æ¡†åˆ°æŒ‡å®šé¡¹ç›®
        function addPlayerInputToProject(projectName) {
            const activePanel = document.querySelector('.project-panel.active');
            if (activePanel) {
                const playerInputs = activePanel.querySelector('.player-inputs');
                if (playerInputs) {
                    const newInputGroup = window.adminManager.generatePlayerInputGroup('', [], playerInputs.children.length);
                    playerInputs.insertAdjacentHTML('beforeend', newInputGroup);
                }
            }
        }

        // ç§»é™¤é€‰æ‰‹è¾“å…¥æ¡†
        function removePlayerInput(button) {
            const playerGroup = button.closest('.player-input-group');
            if (playerGroup) {
                playerGroup.remove();
            }
        }

        // å…³é—­æˆç»©å½•å…¥æ¨¡æ€æ¡†
        function closeScoreEntryModal() {
            const modal = document.getElementById('score-entry-modal');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // å…³é—­å‘¨èµ›ç¼–è¾‘æ¨¡æ€æ¡†
        function closeContestEditModal() {
            const modal = document.getElementById('contest-edit-modal');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // æ·»åŠ é¡¹ç›®åˆ°å‘¨èµ›
        function addProjectToContest() {
            const select = document.getElementById('new-project-select');
            const selectedProject = select.value;
            
            if (!selectedProject) {
                showError('è¯·é€‰æ‹©è¦æ·»åŠ çš„é¡¹ç›®');
                return;
            }

            // æ£€æŸ¥é¡¹ç›®æ˜¯å¦å·²å­˜åœ¨
            const existingProjects = Array.from(document.querySelectorAll('.project-name')).map(el => el.textContent);
            if (existingProjects.includes(selectedProject)) {
                showError('è¯¥é¡¹ç›®å·²å­˜åœ¨');
                return;
            }

            // æ·»åŠ é¡¹ç›®åˆ°åˆ—è¡¨
            const projectsList = document.getElementById('projects-list');
            const projectItem = document.createElement('div');
            projectItem.className = 'project-item';
            projectItem.setAttribute('data-project', selectedProject);
            projectItem.innerHTML = `
                <div class="project-info">
                    <div class="project-name">${selectedProject}</div>
                    <div class="project-stats">
                        å‚èµ›äººæ•°: 0äºº
                    </div>
                </div>
                <div class="project-actions">
                    <!-- çœ¼ç›æŒ‰é’®å·²éšè— -->
                </div>
            `;
            
            projectsList.appendChild(projectItem);
            
            // æ¸…ç©ºé€‰æ‹©
            select.value = '';
            adminManager.updateAddProjectButton();
            
            showSuccess(`é¡¹ç›® ${selectedProject} æ·»åŠ æˆåŠŸ`);
        }

        // ä¿å­˜å‘¨èµ›ç¼–è¾‘
        function saveContestEdit() {
            const contestId = document.getElementById('contest-edit-id').value;
            const week = document.getElementById('edit-week').value;
            const date = document.getElementById('edit-date').value;

            if (!week.trim()) {
                showError('è¯·è¾“å…¥å‘¨æ¬¡');
                return;
            }

            if (!date) {
                showError('è¯·é€‰æ‹©æ—¥æœŸ');
                return;
            }

            // æ”¶é›†ç°æœ‰é¡¹ç›®ï¼ˆä¿ç•™åŸæœ‰æˆç»©æ•°æ®ï¼‰
            const existingProjects = [];
            
            // è·å–å½“å‰å‘¨èµ›çš„å®Œæ•´æ•°æ®
            const currentContest = adminManager.contests.find(c => c._id === contestId);
            if (!currentContest) {
                showError('æ‰¾ä¸åˆ°å‘¨èµ›æ•°æ®');
                return;
            }
            
            // éå†ç•Œé¢ä¸Šæ˜¾ç¤ºçš„é¡¹ç›®ï¼Œä¿ç•™åŸæœ‰æ•°æ®
            Array.from(document.querySelectorAll('.project-item')).forEach(item => {
                const projectName = item.querySelector('.project-name').textContent;
                
                // ä»åŸæ•°æ®ä¸­æŸ¥æ‰¾è¯¥é¡¹ç›®çš„æˆç»©
                const existingProjectData = currentContest.contests.find(c => c.project === projectName);
                
                existingProjects.push({
                    project: projectName,
                    results: existingProjectData ? existingProjectData.results || [] : []
                });
            });

            // æ›´æ–°å‘¨èµ›æ•°æ®
            const updatedContest = {
                week: week.trim(),
                date: date,
                contests: existingProjects
            };

            // è°ƒç”¨APIæ›´æ–°
            adminManager.updateContestData(contestId, updatedContest);
        }

        // æŸ¥çœ‹é¡¹ç›®æˆç»©
        function viewProjectScores(project) {
            showError('æŸ¥çœ‹æˆç»©åŠŸèƒ½å¼€å‘ä¸­');
        }

        // åˆ›å»ºå…¨å±€ç®¡ç†å®ä¾‹
        window.adminManager = new AdminManager();

        // å¿«é€Ÿå½•å…¥æˆç»©
        window.quickAddScore = function() {
            adminManager.quickAddScore();
        };

        // ç¼–è¾‘æˆç»©
        window.editScore = function(index) {
            adminManager.editScore(index);
        };

        // ä¿å­˜æˆç»©ç¼–è¾‘
        window.saveScoreEdit = function(index) {
            adminManager.saveScoreEdit(index);
        };

        // å–æ¶ˆæˆç»©ç¼–è¾‘
        window.cancelScoreEdit = function(index) {
            adminManager.cancelScoreEdit(index);
        };

        // åˆ é™¤æˆç»©
        window.deleteScore = function(index) {
            adminManager.deleteScore(index);
        };

        // åˆ‡æ¢ç¼–è¾‘æ¨¡å¼
        window.toggleEditMode = function() {
            adminManager.toggleEditMode();
        };
        window.toggleMoreProjects = toggleMoreProjects;
        window.addPlayerInput = addPlayerInput;
        window.removePlayerInput = removePlayerInput;
        window.closeScoreEntryModal = closeScoreEntryModal;
        window.closeContestEditModal = closeContestEditModal;
        window.addProjectToContest = addProjectToContest;
        window.saveContestEdit = saveContestEdit;
        window.viewProjectScores = viewProjectScores;

        // ç»‘å®šæˆç»©å½•å…¥è¡¨å•æäº¤äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®æ—¥æœŸè¾“å…¥æ¡†é»˜è®¤ä¸ºå½“å¤©
            const dateInput = document.getElementById('contest-date');
            if (dateInput) {
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                dateInput.value = `${year}-${month}-${day}`;
            }

            // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†åŠ¨æ€ç”Ÿæˆçš„è¡¨å•
            document.addEventListener('submit', function(e) {
                if (e.target.classList.contains('score-entry-form')) {
                    e.preventDefault();
                    if (window.adminManager) {
                        window.adminManager.saveProjectScores(e.target);
                    }
                }
            });

            // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­æ¨¡æ€æ¡†
            const modal = document.getElementById('score-entry-modal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeScoreEntryModal();
                    }
                });
            }
        });
    </script>
</body>
</html>
